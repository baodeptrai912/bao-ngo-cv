<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.springframework.org/tags/security"
      lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile</title>
    <script src="/js/FetchNotification.js" defer></script>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/whole.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        .profile-container {
            margin-top: 40px;
            padding: 30px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0px 6px 20px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            font-weight: 700;
            color: #333;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 3px solid #f39c12;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .avatar-upload {
            text-align: center;
            margin-bottom: 30px;
        }

        .avatar-upload img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }

        .btn-custom {
            background-color: #f39c12;
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            transition: background-color 0.3s ease;
        }

        .btn-custom:hover {
            background-color: #e67e22;
        }

        .btn-add, .btn-remove {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f39c12;
            color: white;
            border: none;
            font-size: 1.5rem;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
            cursor: pointer;
            margin-left: 10px;
        }

        .btn-add:hover {
            background-color: #e67e22;
        }

        .btn-remove {
            background-color: #c0392b;
        }

        .btn-remove:hover {
            background-color: #a93226;
        }

        .work-experience-item, .education-item {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .work-experience-item .form-group, .education-item .form-group {
            flex: 1;
            margin-right: 10px;
        }

        section {
            margin-bottom: 40px;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 45px;
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(145deg, #007BFF, #0056b3);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.3), -3px -3px 8px rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .btn:hover {
            background: linear-gradient(145deg, #0056b3, #003e7d);
            transform: translateY(-3px);
            box-shadow: 6px 6px 12px rgba(0, 0, 0, 0.3), -6px -6px 12px rgba(255, 255, 255, 0.1);
        }

        .education-item {
            background-color: #f9f9f9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .jobExperience-item {
            background-color: #f9f9f9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .education-info, .work-experience-info {
            flex-grow: 1;
        }

        .education-actions button, .work-experience-actions button {
            margin-left: 10px;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-edit {
            background-color: #4caf50;
            color: white;
        }

        .btn-delete {
            background-color: #f44336;
            color: white;
        }

        .education-actions button:hover, .work-experience-actions button:hover {
            opacity: 0.8;
        }

        .empty-message {
            background-color: #ff2222;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 16px;
            font-weight: 500;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }

        .empty-message:hover {
            background-color: #e64a19;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .form-control:focus {
            border-color: #4caf50;
            outline: none;
        }

        .btn-add {
            background-color: #4caf50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-add:hover {
            opacity: 0.8;
        }

        #workExperienceContainer .form-group, #educationContainer .form-group {
            margin-bottom: 15px;
        }

        #workExperienceContainer .form-group label, #educationContainer .form-group label {
            font-weight: 600;
            font-size: 14px;
        }

        #workExperienceContainer .form-control, #educationContainer .form-control {
            padding: 10px;
            font-size: 14px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #workExperienceContainer .btn-add, #educationContainer .btn-add {
            background-color: #4caf50;
            color: white;
            padding: 10px 20px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #workExperienceContainer .btn-add:hover, #educationContainer .btn-add:hover {
            background-color: #388e3c;
        }.old-value {
             color: #6c757d; /* Màu xám mờ */
             font-style: italic; /* Kiểu chữ nghiêng */
             text-decoration: underline; /* Gạch dưới */
         }


    </style>
</head>

<body>

<!-- Header -->
<div th:replace="fragments/headerAndFooter :: header"></div>

<div class="button-container" style="margin-top: 20px;">
    <button class="btn" onclick="showSection('personalInfo', this)">
        <i class="fas fa-user"></i> Personal Info
    </button>
    <button class="btn" onclick="showSection('educationSectionId', this)">
        <i class="fas fa-graduation-cap"></i> Education
    </button>
    <button class="btn" onclick="showSection('experienceSectionId', this)">
        <i class="fas fa-briefcase"></i> Experience
    </button>
</div>

<!-- Edit Profile Section -->
<div class="container">

    <!-- Personal Information Section -->
    <section class="profile-container" id="personalInfo">
        <h2 class="section-title">Personal Information</h2>
        <div th:if="${successMessage}" class="alert alert-success d-flex align-items-center" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <div>
                <span th:text="${successMessage}"></span>
            </div>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger d-flex align-items-center" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <div>
                <span th:text="${errorMessage}"></span>
            </div>
        </div>
        <form method="post" th:action="@{/jobseeker/personal-infor-update}" th:object="${personalInforUpdateDTO}" enctype="multipart/form-data">
            <!-- Avatar Upload -->
            <div class="avatar-upload">
                <!-- Kiểm tra nếu profileImageUrl là null hoặc rỗng -->
                <img th:src="${profileImageUrl}"
                     style="width: 100px;" alt="Avatar" id="profileImage">
                <input type="file" id="avatarUpload" name="avatar" class="form-control" onchange="previewAvatar(this)">
            </div>

            <!-- Full Name -->
            <div class="form-group">
                <div class="error text-danger" th:errors="*{fullName}">
                    <i class="fas fa-user-slash"></i>
                </div>
                <label for="fullName">Full Name</label>
                <input type="text" id="fullName" th:field="*{fullName}" class="form-control">
            </div>

            <!-- Email -->
            <div class="form-group">
                <div class="error text-danger" th:errors="*{email}">
                    <i class="fas fa-user-slash"></i>
                </div>
                <label for="email">Email</label>
                <input type="email" id="email" th:field="*{email}" class="form-control" readonly>
            </div>

            <!-- Phone -->
            <div class="form-group">
                <div class="error text-danger" th:errors="*{phone}">
                    <i class="fas fa-user-slash"></i>
                </div>
                <label for="phone">Phone</label>
                <input type="text" id="phone" th:field="*{phone}" class="form-control">
            </div>

            <!-- Location -->
            <div class="form-group">
                <div class="error text-danger" th:errors="*{location}">
                    <i class="fas fa-user-slash"></i>
                </div>
                <label for="location">Location</label>
                <input type="text" id="location" th:field="*{location}" name="location" class="form-control">
            </div>

            <!-- Date of Birth -->
            <div class="form-group">
                <div class="error text-danger" th:errors="*{dateOfBirth}">
                    <i class="fas fa-calendar-day"></i>
                </div>
                <label for="dateOfBirth">Date of Birth</label>
                <span th:if="${personalInforUpdateDTO.dateOfBirth}"  th:text="${personalInforUpdateDTO.dateOfBirth}" class="old-value"></span>
                <input type="date" id="dateOfBirth" th:field="*{dateOfBirth}" class="form-control">
            </div>

            <!-- Nationality -->
            <div class="form-group">
                <div class="error text-danger" th:errors="*{nationality}">
                    <i class="fas fa-globe"></i>
                </div>
                <label for="nationality">Nationality</label>
                <input type="text" id="nationality"  th:field="*{nationality}" class="form-control">
            </div>

            <!-- Gender -->
            <div class="form-group">
                <div class="error text-danger" th:errors="*{gender}">
                    <i class="fas fa-venus-mars"></i>
                </div>
                <label for="gender">Gender</label>
                <select id="gender" th:field="*{gender}" class="form-control">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <!-- Submit Button -->
            <div class="text-center">
                <button type="submit" class="btn-custom">Save Profile</button>
            </div>
        </form>

    </section>

    <!-- Education Section -->
    <section class="profile-container" id="educationSectionId">
        <h2 class="section-title">Education

        </h2>

        <!-- Danh sách giáo dục -->
        <div th:if="${not #lists.isEmpty(educations)}" class="education-list">
            <div th:each="education : ${educations}" class="education-item">
                <div th:data-id="${education.id}" class="education-item-need">
                    <div class="education-info">
                        <strong>Degree:</strong> <span class="degree" th:text="${education.degree}"></span> |
                        <strong>Institution:</strong> <span class="institution"
                                                            th:text="${education.institution}"></span> |
                        <strong>Start Date:</strong> <span class="startDate" th:text="${education.startDate}"></span> |
                        <strong>End Date:</strong> <span class="endDate" th:text="${education.endDate}"></span> |
                        <strong>Details:</strong> <span class="notes" th:text="${education.notes}"></span>
                    </div>


                    <div class="education-actions">
                        <button type="button" class="btn-edit"
                                data-bs-toggle="modal" data-bs-target="#editEducationModal"
                                th:data-id="${education.id}"
                                th:data-degree="${education.degree}"
                                th:data-institution="${education.institution}"
                                th:data-start-date="${education.startDate}"
                                th:data-end-date="${education.endDate}"
                                th:id="${education.id}"
                                th:data-notes="${education.notes}">

                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button type="button" class="btn-delete" onclick="deleteEducation()">
                            <i class="fas fa-trash-alt"></i> Delete
                        </button>
                        <input type="hidden" id="educationId" th:value="${education.id}">
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="editEducationModal" tabindex="-1" aria-labelledby="editEducationModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editEducationModalLabel">Edit Education</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Form Inputs -->
                        <div type="hidden" id="updatedId"></div>
                        <div class="mb-3">
                            <label for="editDegreeInput" class="form-label">Degree</label>
                            <select id="editDegreeInput" name="editDegreeInput" class="form-control" required>
                                <option value="" disabled selected>Select your degree</option>
                                <option value="Bachelors">Bachelor's</option>
                                <option value="Masters">Master's</option>
                                <option value="PhD">PhD</option>
                                <option value="Associate's">Associate's</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editInstitutionInput" class="form-label">Institution</label>
                            <input type="text" class="form-control" id="editInstitutionInput">
                        </div>
                        <div class="mb-3">
                            <label for="editStartDateInput" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="editStartDateInput">
                        </div>
                        <div class="mb-3">
                            <label for="editEndDateInput" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="editEndDateInput">
                        </div>
                        <div class="mb-3">
                            <label for="editDetailsInput" class="form-label">Details</label>
                            <textarea class="form-control" id="editDetailsInput"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">

                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>


        <div id="eduEmpty" class="empty-message">
            <p><i class="fas fa-info-circle"></i> You don't have any yet, add to increase your chances of getting a job.
            </p>
        </div>

        <!-- Form thêm giáo dục -->
        <form id="educationForm">
            <div id="educationContainer">
                <div class="education-item">
                    <div class="form-group">
                        <label for="degree">Degree</label>
                        <select id="degree" name="degree" class="form-control" required>
                            <option value="" disabled selected>Select your degree</option>
                            <option value="Bachelors">Bachelor's</option>
                            <option value="Masters">Master's</option>
                            <option value="PhD">PhD</option>
                            <option value="Associate's">Associate's</option>
                        </select>
                    </div>

                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <div class="form-group">
                        <label for="institution">Institution</label>
                        <input type="text" id="institution" name="institution[]" class="form-control"
                               placeholder="University Name" required>
                    </div>
                    <div class="form-group">
                        <label for="startDate">Start Date</label>
                        <input type="date" id="startEducationDate" name="educationStartDate[]" class="form-control"
                               required>
                    </div>
                    <div class="form-group">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endEducationDate" name="educationEndDate[]" class="form-control"
                               required>
                    </div>
                    <div class="form-group">
                        <label for="educationDetail">Details</label>
                        <textarea name="educationDetail[]" id="educationDetail" class="form-control" rows="3"
                                  placeholder="Relevant courses, achievements..." required></textarea>
                    </div>
                    <button type="submit" class="btn-add">
                        <i class="fas fa-plus-circle"></i> Add
                    </button>

                </div>
            </div>

        </form>
    </section>

    <!-- Job Experience Section -->
    <section class="profile-container" id="experienceSectionId">
        <h2 class="section-title">Work Experience</h2>

        <!-- Danh sách công việc -->
        <div id="jobExExist" th:if="${not #lists.isEmpty(jobExperiences)}" class="job-ex-list">
            <div th:each="jobExperience : ${jobExperiences}" class="jobExperience-item">
                <div th:data-id="${jobExperience.id}" class="jobExperience-item-need">
                    <div class="education-info">
                        <strong>Job Title:</strong> <span class="jobTitle" th:text="${jobExperience.jobTitle}"></span>
                        <strong>Company:</strong> <span class="companyName"
                                                        th:text="${jobExperience.companyName}"></span>
                        <strong>Start Date:</strong> <span class="startDate"
                                                           th:text="${jobExperience.startDate}"></span>
                        <strong>End Date:</strong> <span class="endDate" th:text="${jobExperience.endDate}"></span>
                        <strong>Details:</strong> <span class="description"
                                                        th:text="${jobExperience.description}"></span>
                    </div>
                    <!-- Nút chỉnh sửa và xóa -->
                    <div class="education-actions">
                        <button type="button"
                                class="btn-edit"
                                data-bs-toggle="modal"
                                data-bs-target="#editJobModal"
                                th:data-id="${jobExperience.id}"
                                th:data-job-title="${jobExperience.jobTitle}"
                                th:data-company-name="${jobExperience.companyName}"
                                th:data-start-date="${jobExperience.startDate}"
                                th:data-end-date="${jobExperience.endDate}"
                                th:data-description="${jobExperience.description}">
                            <i class="fas fa-edit"></i> Edit
                        </button>


                        <button type="button" class="btn-delete" onclick="deleteJobEx()">
                            <i class="fas fa-trash-alt"></i> Delete
                        </button>
                        <input type="hidden" id="jobExperienceId" th:value="${jobExperience.id}">
                    </div>
                </div>
            </div>
        </div>

        <div id="jobExEmpty" class="empty-message">
            <p><i class="fas fa-info-circle"></i> You don't have any yet, add to increase your chances of getting a job.
            </p>

        </div>

        <!-- Job experience modal -->
        <div class="modal fade" id="editJobModal" tabindex="-1" aria-labelledby="editJobModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editJobModalLabel">Edit Work Experience</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="editJobForm">
                            <input type="hidden" id="editJobId">
                            <div class="mb-3">
                                <label for="editJobTitle" class="form-label">Job Title</label>
                                <input type="text" class="form-control" id="editJobTitle" required>
                            </div>
                            <div class="mb-3">
                                <label for="editCompanyName" class="form-label">Company Name</label>
                                <input type="text" class="form-control" id="editCompanyName" required>
                            </div>
                            <div class="mb-3">
                                <label for="editStartDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="editStartDate" required>
                            </div>
                            <div class="mb-3">
                                <label for="editEndDate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="editEndDate">
                            </div>
                            <div class="mb-3">
                                <label for="editDescription" class="form-label">Details</label>
                                <textarea class="form-control" id="editDescription" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">

                        <button type="button" class="btn btn-primary" onclick="saveEdit()">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form thêm công việc -->
        <form id="jobExperienceForm">
            <div id="workExperienceContainer">
                <div class="education-item">
                    <div class="form-group">
                        <label for="jobTitle">Job Title</label>
                        <input type="text" id="jobTitle" name="jobTitle[]" class="form-control"
                               placeholder="Software Engineer" required>
                    </div>
                    <div class="form-group">
                        <label for="companyName">Company Name</label>
                        <input type="text" id="companyName" name="companyName[]" class="form-control"
                               placeholder="Tech Company" required>
                    </div>
                    <div class="form-group">
                        <label for="startDate">Start Date</label>
                        <input type="date" id="startDate" name="startDate[]" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endDate" name="endDate[]" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="jobDetail">Details</label>
                        <textarea id="jobDetail" name="jobDetail[]" class="form-control" rows="3"
                                  placeholder="Responsible for developing web applications..." required></textarea>
                    </div>

                    <button type="submit" class="btn-add">
                        <i class="fas fa-plus-circle"></i> Add
                    </button>


                </div>
            </div>
        </form>
    </section>

</div>

<!-- Footer -->
<div th:replace="fragments/headerAndFooter :: footer"></div>
<!-- JavaScript for Previewing Avatar and Adding/Removing Items -->
<script th:inline="javascript">
    const csrfToken = document.querySelector('input[name="_csrf"]').value;
    const showEducation = [[${showEducation}]];
    const showJobEx = [[${showJobEx}]];
    const emptyMessage = document.getElementById("eduEmpty");

    const jobExEmptyMessage = document.getElementById("jobExEmpty");
    let educationList = document.querySelector('.education-list');
    document.addEventListener("DOMContentLoaded", () => {
        if (showJobEx) {

            jobExEmptyMessage.style.display = "none";

        } else {

            jobExEmptyMessage.style.display = "block";
        }


        if (showEducation) {
            emptyMessage.style.display = "none";
        } else {
            emptyMessage.style.display = "block";
        }
    });


    function showSection(sectionId, button) {
        // Hide all sections
        document.getElementById('personalInfo').style.display = 'none';
        document.getElementById('educationSectionId').style.display = 'none';
        document.getElementById('experienceSectionId').style.display = 'none';


        const activeSection = document.getElementById(sectionId);
        if (activeSection) {
            activeSection.style.display = 'block';
        }


        const buttons = document.querySelectorAll('.btn');
        buttons.forEach(btn => {
            btn.style.background = 'linear-gradient(145deg, #007BFF, #0056b3)';
            btn.style.color = 'white';
        });


        button.style.background = 'linear-gradient(145deg, #0056b3, #003e7d)';
        button.style.color = 'black';
    }

    // Set default section on page load
    window.onload = function () {
        showSection('personalInfo', document.querySelector('.btn')); // Default button
    };


    document.getElementById("educationForm").addEventListener("submit", function (event) {
        event.preventDefault(); // Ngừng hành động mặc định của form

        // Lấy giá trị từ các trường trong form
        const degreeValidation = document.getElementById("degree").value;
        const institutionValidation = document.getElementById("institution").value;
        const startDateValidation = document.getElementById("startEducationDate").value;
        const endDateValidation = document.getElementById("endEducationDate").value;
        const detailsValidation = document.getElementById("educationDetail").value;

        // Kiểm tra validation cơ bản
        if (!degreeValidation || !institutionValidation || !startDateValidation || !endDateValidation || !detailsValidation) {
            alert("Please fill in all required fields.");
            return;
        }

        // Kiểm tra ngày tháng hợp lệ
        if (new Date(startDateValidation) > new Date(endDateValidation)) {
            alert("Start date cannot be after end date.");
            return;
        }

        // Tạo đối tượng FormData từ form
        const formData = new FormData(this);


        const education = {
            degree: degreeValidation,
            institution: institutionValidation,
            educationStartDate: startDateValidation,
            educationEndDate: endDateValidation,
            educationDetail: detailsValidation
        };

        fetch('/jobseeker/education-update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': formData.get("_csrf")
            },
            body: JSON.stringify(education),
        })
            .then(response => response.json())
            .then(data => {
                console.log("Success:", data);

                if (data.message) {
                    alert(data.message);
                    console.log(data);


                    if (!educationList) {
                        // Tạo phần tử education-list
                        educationList = document.createElement('div');
                        educationList.classList.add('education-list');

                        // Tìm phần tử cha để thêm educationList vào (giả sử là một phần tử với id 'educationContainer')
                        const educationContainer = document.getElementById('educationContainer');
                        if (educationContainer) {
                            educationContainer.appendChild(educationList);
                        }
                    }


                    const educationItem = document.createElement('div');
                    educationItem.classList.add('education-item');
                    const educationId = data.educationId; // Đảm bảo rằng `data.educationId` có giá trị hợp lệ


                    educationItem.innerHTML = `

    <div data-id="${educationId}" class="education-item-need">
        <div class="education-info">
            <strong>Degree:</strong> <span class="degree">${degreeValidation}</span> |
            <strong>Institution:</strong> <span class="institution">${institutionValidation}</span> |
            <strong>Start Date:</strong> <span class="startDate">${startDateValidation}</span> |
            <strong>End Date:</strong> <span class="endDate">${endDateValidation}</span> |
            <strong>Details:</strong> <span class="notes">${detailsValidation}</span>
        </div>
        <div class="education-actions">

             <button type="button" class="btn-edit"
                                data-bs-toggle="modal" data-bs-target="#editEducationModal"
                                data-id="${data.educationId}"
                                data-degree="${data.degree}"
                                data-institution="${data.institution}"
                                data-start-date="${data.startDate}"
                                data-end-date="${data.endDate}"
                                id="${data.id}"
                                data-notes="${data.notes}">

                            <i class="fas fa-edit"></i> Edit
                        </button>
                          <button type="button" class="btn-delete" onclick="deleteEducation()">
                            <i class="fas fa-trash-alt"></i> Delete
                        </button>
            <input type="hidden" id="educationId" value="${data.educationId}">
        </div>
    </div>
`;

                    educationList.appendChild(educationItem);


                    if (emptyMessage) {
                        emptyMessage.style.display = 'none';
                    }

                    if (educationList.style.display === 'none') {
                        educationList.style.display = 'block';
                    }

                } else if (data.error || data.errorLimitation) {
                    if (data.error) {
                        alert(data.error);
                    }
                    if (data.errorLimitation) {
                        alert(data.errorLimitation);
                    }
                }
            })
            .catch((error) => {
                console.error("Error:", error);

            });

    });


    function deleteEducation() {
        // Lấy giá trị của educationId từ thẻ input hidden
        const educationId = document.getElementById('educationId').value;
        console.log(educationId);


        if (isNaN(educationId) || educationId.trim() === '') {
            alert('ID is not valid.');
            return;
        }


        const isConfirmed = window.confirm("Are you sure you want to delete this education?");

        // Nếu người dùng chọn OK, thực hiện xóa
        if (isConfirmed) {
            // Gửi yêu cầu DELETE đến API
            fetch(`/jobseeker/education-update/${educationId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': csrfToken // Đảm bảo csrfToken đã được định nghĩa đúng
                }
            })
                .then(response => {
                    if (response.ok) {
                        const educationElements = document.querySelector(`.education-item-need[data-id='${educationId}']`);
                        if (educationElements) {
                            const parentElement = educationElements.parentElement; // Lấy phần tử cha
                            if (parentElement) {
                                parentElement.remove(); // Xóa phần tử cha khỏi DOM
                            }

                            const educationList = document.querySelector('.education-list');
                            const remainingEducationItems = educationList.querySelectorAll('.education-item-need');

                            if (remainingEducationItems.length === 0 && emptyMessage) {
                                if (emptyMessage) {
                                    emptyMessage.style.display = 'block'; // Hiển thị thông báo "You don't have any yet"
                                }
                            } else {
                                emptyMessage.style.display = 'none'; // Ẩn thông báo nếu còn phần tử
                            }

                            alert('Deleted successfully!');
                        } else {
                            alert('Education element not found in the DOM.');
                        }
                    } else {
                        // Nếu có lỗi, xử lý thông báo lỗi từ API
                        return response.json().then(data => {
                            // Hiển thị lỗi từ API
                            if (data && data.error) {
                                alert('Error: ' + data.error);
                            } else {
                                alert('Unknown error occurred');
                            }
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting.');
                });
        }
    }

    document.getElementById('editEducationModal').addEventListener('shown.bs.modal', function (event) {
        // Lấy đối tượng nút Edit mà người dùng đã nhấn
        var button = event.relatedTarget;

        // Lấy dữ liệu từ các thuộc tính data-* của nút
        var degree = button.getAttribute('data-degree');
        var institution = button.getAttribute('data-institution');
        var startDate = button.getAttribute('data-start-date');
        var endDate = button.getAttribute('data-end-date');
        var notes = button.getAttribute('data-notes');
        var id = button.getAttribute('data-id');
        // Điền dữ liệu vào các trường trong modal
        document.getElementById('editDegreeInput').value = degree;
        document.getElementById('editInstitutionInput').value = institution;
        document.getElementById('editStartDateInput').value = startDate;
        document.getElementById('editEndDateInput').value = endDate;
        document.getElementById('editDetailsInput').value = notes;
        document.getElementById('updatedId').value = id;
    });


    document.querySelector('.modal-footer .btn-primary').addEventListener('click', function () {
        var id = document.getElementById('updatedId').value;
        var updatedDegree = document.getElementById('editDegreeInput').value;
        var updatedInstitution = document.getElementById('editInstitutionInput').value;
        var updatedStartDate = document.getElementById('editStartDateInput').value;
        var updatedEndDate = document.getElementById('editEndDateInput').value;
        var updatedNotes = document.getElementById('editDetailsInput').value;

        // Kiểm tra xem người dùng đã điền đầy đủ thông tin chưa
        if (updatedDegree && updatedInstitution && updatedStartDate && updatedEndDate) {

            fetch('/jobseeker/edit-education', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': csrfToken
                },
                body: JSON.stringify({
                    id: id,
                    degree: updatedDegree,
                    institution: updatedInstitution,
                    startDate: updatedStartDate,
                    endDate: updatedEndDate,
                    notes: updatedNotes
                })
            })
                .then(response => response.json())  // Chuyển đổi dữ liệu trả về từ server thành JSON
                .then(data => {
                    if (data.message) {

                        var modal = document.getElementById('editEducationModal');
                        var modalInstance = bootstrap.Modal.getInstance(modal); // Lấy instance của modal
                        modalInstance.hide(); // Đóng modal

                        // Cập nhật lại thông tin trong DOM với dữ liệu trả về từ server
                        updateEducationInDOM(data);
                    } else {
                        // Hiển thị thông báo lỗi nếu có
                        alert('Cập nhật thất bại: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Có lỗi xảy ra:', error);
                    alert('Có lỗi xảy ra khi cập nhật dữ liệu.');
                });
        } else {
            // Nếu thiếu thông tin, hiển thị cảnh báo
            alert('Vui lòng điền đầy đủ thông tin.');
        }
    });

    function updateEducationInDOM(updatedEducation) {
        console.log(updatedEducation);
        // Tìm phần tử DOM chứa thông tin giáo dục
        var educationItem = document.querySelector('.education-item-need[data-id="' + updatedEducation.id + '"]');
        console.log(educationItem);
        if (educationItem) {
            // Cập nhật thông tin trong DOM
            educationItem.querySelector('.education-info .degree').textContent = updatedEducation.degree;
            educationItem.querySelector('.education-info .institution').textContent = updatedEducation.institution;
            educationItem.querySelector('.education-info .startDate').textContent = updatedEducation.startDate; // Cập nhật start date
            educationItem.querySelector('.education-info .endDate').textContent = updatedEducation.endDate; // Cập nhật end date
            educationItem.querySelector('.education-info .notes').textContent = updatedEducation.notes; // Cập nhật notes

            // Cập nhật lại dữ liệu trong nút Edit (thêm dữ liệu vào các thuộc tính data-* của button)
            var editButton = educationItem.querySelector('.btn-edit');
            editButton.setAttribute('data-degree', updatedEducation.degree);
            editButton.setAttribute('data-institution', updatedEducation.institution);
            editButton.setAttribute('data-start-date', updatedEducation.startDate);
            editButton.setAttribute('data-end-date', updatedEducation.endDate);
            editButton.setAttribute('data-notes', updatedEducation.notes);
            editButton.setAttribute('data-id', updatedEducation.id);
            alert("Information is updated successfully")
        }


    }


    document.getElementById("jobExperienceForm").addEventListener("submit", function (event) {
        event.preventDefault(); // Ngừng hành động mặc định của form

        // Lấy giá trị từ các trường trong form
        const jobTitleValidation = document.getElementById("jobTitle").value;
        const companyNameValidation = document.getElementById("companyName").value;
        const startDateValidation = document.getElementById("startDate").value;
        const endDateValidation = document.getElementById("endDate").value;
        const jobDetailValidation = document.getElementById("jobDetail").value;

        // Kiểm tra validation cơ bản
        if (!jobTitleValidation || !companyNameValidation || !startDateValidation || !endDateValidation || !jobDetailValidation) {
            alert("Please fill in all required fields.");
            return;
        }

        // Kiểm tra ngày tháng hợp lệ
        if (new Date(startDateValidation) > new Date(endDateValidation)) {
            alert("Start date cannot be after end date.");
            return;
        }

        // Tạo đối tượng chứa dữ liệu công việc cần gửi đi
        const jobExperience = {
            jobTitle: jobTitleValidation,
            companyName: companyNameValidation,
            startDate: startDateValidation,
            endDate: endDateValidation,
            description: jobDetailValidation
        };


        // Sử dụng fetch để gửi dữ liệu qua phương thức POST
        fetch('/jobseeker/job-ex-update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': csrfToken
            },
            body: JSON.stringify(jobExperience) // Chuyển dữ liệu thành JSON
        })
            .then(response => response.json()) // Chuyển phản hồi thành JSON
            .then(data => {
                if (data.message) {
                    // Nếu thành công, hiển thị thông điệp thành công
                    alert(data.message);

                    // Tạo phần tử HTML cho công việc mới
                    const newJobExperience = document.createElement('div');
                    newJobExperience.setAttribute('data-id', data.id);
                    newJobExperience.classList.add('jobExperience-item');

                    // Thêm nội dung vào phần tử mới
                    newJobExperience.innerHTML = `
   <div data-id="${data.id}" class="jobExperience-item-need">
                    <div class="education-info">
                        <strong>Job Title:</strong> <span class="jobTitle">${jobTitleValidation}</span> |
                        <strong>Company:</strong> <span class="companyName">${companyNameValidation}</span> |
                        <strong>Start Date:</strong> <span class="startDate">${startDateValidation}</span> |
                        <strong>End Date:</strong> <span class="endDate">${endDateValidation}</span> |
                        <strong>Details:</strong> <span class="description">${jobDetailValidation}</span>
                    </div>
                    <div class="education-actions">

                    <button type="button"
                                class="btn-edit"
                                data-bs-toggle="modal"
                                data-bs-target="#editJobModal"
                                data-id="${data.id}"
                                data-job-title="${jobTitleValidation}"
                                data-company-name="${companyNameValidation}"
                                data-start-date="${startDateValidation}"
                                data-end-date="${endDateValidation}"
                                data-description="${jobDetailValidation}">
                            <i class="fas fa-edit"></i> Edit
                        </button>



                        <button type="button" class="btn-delete" onclick="deleteJobEx()">
                            <i class="fas fa-trash-alt"></i> Delete
                        </button>
                       <input type="hidden" id="jobExperienceId"  value="${data.id}"></input>
                    </div>
                    </div>
                `;


                    jobExEmptyMessage.style.display = 'none'; // Hiển thị thông báo "You don't have any yet"

                    // Tìm container và thêm công việc mới vào
                    const jobExList = document.getElementById('jobExExist');
                    jobExList.appendChild(newJobExperience);

                    // Reset form sau khi thêm
                    document.getElementById('jobTitle').value = '';
                    document.getElementById('companyName').value = '';
                    document.getElementById('startDate').value = '';
                    document.getElementById('endDate').value = '';
                    document.getElementById('jobDetail').value = '';
                } else if (data.error) {
                    // Nếu có lỗi, hiển thị thông báo lỗi
                    alert(data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert("There was an error processing your request.");
            });
    });


    function deleteJobEx() {
        // Lấy giá trị của educationId từ thẻ input hidden
        const jobExperienceId = document.getElementById('jobExperienceId').value;
        console.log(jobExperienceId);

        if (isNaN(jobExperienceId) || jobExperienceId.trim() === '') {
            alert('ID is not valid.');
            return;
        }


        const isConfirmed = window.confirm("Are you sure you want to delete this job ex?");

        const payload = {
            id: jobExperienceId
        };
        // Nếu người dùng chọn OK, thực hiện xóa
        if (isConfirmed) {
            // Gửi yêu cầu DELETE đến API
            fetch(`/jobseeker/job-ex-update`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',

                    'X-CSRF-TOKEN': csrfToken // Đảm bảo csrfToken đã được định nghĩa đúng

                },
                body: JSON.stringify(payload)
            })
                .then(response => {
                    if (response.ok) {
                        const jobExperienceElements = document.querySelector(`.jobExperience-item-need[data-id='${jobExperienceId}']`);
                        if (jobExperienceElements) {
                            const parentElement = jobExperienceElements.parentElement; // Lấy phần tử cha
                            if (parentElement) {
                                parentElement.remove(); // Xóa phần tử cha khỏi DOM
                            }

                            const educationList = document.querySelector('.job-ex-list');
                            const remainingEducationItems = educationList.querySelectorAll('.jobExperience-item-need');

                            if (remainingEducationItems.length === 0 && emptyMessage) {
                                if (jobExEmptyMessage) {
                                    jobExEmptyMessage.style.display = 'block'; // Hiển thị thông báo "You don't have any yet"
                                }
                            } else {
                                jobExEmptyMessage.style.display = 'none'; // Ẩn thông báo nếu còn phần tử
                            }

                            alert('Deleted successfully!');
                        } else {
                            alert('Education element not found in the DOM.');
                        }
                    } else {
                        // Nếu có lỗi, xử lý thông báo lỗi từ API
                        return response.json().then(data => {
                            // Hiển thị lỗi từ API
                            if (data && data.error) {
                                alert('Error: ' + data.error);
                            } else {
                                alert('Unknown error occurred');
                            }
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting.');
                });
        }
    }


    document.getElementById('editJobModal').addEventListener('show.bs.modal', function (event) {
        // Lấy nút đã kích hoạt modal
        const button = event.relatedTarget;

        // Lấy dữ liệu từ thuộc tính data-*
        const jobId = button.getAttribute('data-id');
        const jobTitle = button.getAttribute('data-job-title');
        const companyName = button.getAttribute('data-company-name');
        const startDate = button.getAttribute('data-start-date');
        const endDate = button.getAttribute('data-end-date');
        const description = button.getAttribute('data-description');

        // Điền dữ liệu vào modal
        document.getElementById('editJobId').value = jobId;
        document.getElementById('editJobTitle').value = jobTitle;
        document.getElementById('editCompanyName').value = companyName;
        document.getElementById('editStartDate').value = startDate;
        document.getElementById('editEndDate').value = endDate;
        document.getElementById('editDescription').value = description;
    });

    function saveEdit() {
        const jobId = document.getElementById('editJobId').value;
        const jobTitle = document.getElementById('editJobTitle').value;
        const companyName = document.getElementById('editCompanyName').value;
        const startDate = document.getElementById('editStartDate').value;
        const endDate = document.getElementById('editEndDate').value;
        const description = document.getElementById('editDescription').value;

        // Kiểm tra validation cho startDate và endDate
        if (new Date(startDate) > new Date(endDate)) {
            alert('Start date must be before the end date.');
            return; // Ngăn không cho gửi request
        }

        // Gửi dữ liệu đến server
        fetch(`/jobseeker/job-ex-update/${jobId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': csrfToken // Nếu có CSRF Token
            },
            body: JSON.stringify({jobTitle, companyName, startDate, endDate, description})
        })
            .then(response => response.json()) // Đảm bảo phản hồi là JSON
            .then(data => {
                if (data.error) {
                    alert('Failed to update job experience.');
                } else {
                    // Cập nhật giao diện
                    const jobExperienceItem = document.querySelector(`.jobExperience-item-need[data-id='${jobId}']`);
                    jobExperienceItem.querySelector('.education-info .jobTitle').textContent = jobTitle;
                    jobExperienceItem.querySelector('.education-info .companyName').textContent = companyName;
                    jobExperienceItem.querySelector('.education-info .startDate').textContent = startDate;
                    jobExperienceItem.querySelector('.education-info .endDate').textContent = endDate;
                    jobExperienceItem.querySelector('.education-info .description').textContent = description;

                    // Đóng modal
                    bootstrap.Modal.getInstance(document.getElementById('editJobModal')).hide();

                    // Thông báo thành công
                    alert('Job experience updated successfully!');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while updating job experience.');
            });
    }


</script>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

</body>
</html>
